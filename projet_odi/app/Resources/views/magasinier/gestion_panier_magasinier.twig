{% extends 'base.html.twig' %}

{% block menu %}
    {% include 'client/menu_client.twig' %}
{% endblock %}

{% block header %}
{% endblock %}

{% block section %}
    <h2>Contenu du panier : {{ Panier.getIdPanier() }} </h1>
    <div class="container">
	<table class="table table-striped " style="background-color:lightblue;">
  	    <thead>
          <tr>
            <th>ref</th>
            <th>nom</th>
            <th>qtt comand√©e restante</th>
            <th>qtt en stock</th>
            <th>qtt a delivrer</th>
            <th>gestion</th>
          </tr>
        </thead>
        <tbody>
          {% set cpt=0 %}
          {% for contenir in Contenir %}
            {% set cpt = cpt+1 %} 
    	    <tr>
              <td>{{ contenir.getRefProduit() }}</td>
              {% for produit in Produit %}
              {% if produit.getRefProduit() == contenir.getRefProduit() %}
                <td>{{ produit.getNomProduit() }}</td>
              {% endif %}
              {% endfor %}
              <td>{{ contenir.getQuantiteProduit() - contenir.getQuantiteProduitGeree() }}</td>
              {% for produit in Produit %}
              {% if produit.getRefProduit() == contenir.getRefProduit() %}
                <td>{{ produit.getQuantiteProduit() }}</td>
              {% endif %}
              {% endfor %}
              <td>
                <input type="number" id="qtt{{ cpt }}" value="1"></input>
              </td>
              <td>
                {% if (contenir.getQuantiteProduit() - contenir.getQuantiteProduitGeree()) == 0 %}
                  OK
                {% else %}
                  <a type="button" class="btn btn-default btn-sm" onclick="confirme('{{ cpt }}','{{ Panier.getIdPanier() }}','{{ contenir.getRefProduit() }}')">{% set qtt %}3{% endset %}Confirmer</a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% set validate = 1 %}
      {% for contenir in Contenir %}
        {% if (contenir.getQuantiteProduit() - contenir.getQuantiteProduitGeree()) > 0 %}
          {% set validate = 0 %}
        {% endif %}
      {% endfor %}
      
      {% if validate == 1 %}
        <a type="button" class="btn btn-success btn-sm" href="{{ path('gestion_panier_valider_magasinier', { id_panier : Panier.getIdPanier() }) }}" >Valider panier</a>
      {% else %}
        <a type="button" class="btn btn-danger btn-sm" href="#" >Valider panier</a>
      {% endif %}
      </div>
      
      
      
      
  <script>
  function confirme(cpt,id_panier,ref){
	var qtt = $("#qtt"+cpt).val();
    //alert("cpt="+cpt+" ref="+ref+" idpanier="+id_panier+" qtt="+qtt);
    
    //on recupere l'url
   	var str = location.href;
   	var lgth = str.length;

   	//taille de "gestion_panier/"+id_panier
   	var lgthFin = "gestion_panier/"+id_panier;
   	lgthFin = lgthFin.length;


   	//on recupere la partie de l'url devant(ou pas) contenir "creation_panier"
   	var test = str.substring(lgth-lgthFin, lgth);
   	var res = str.substring(0, lgth-lgthFin);

   	//alert("res="+res+"  test="+test);	
    //on test et on modifie en consequence
   	if(test.localeCompare("gestion_panier")==0)
   	  res += "produit_gestion_panier/"+id_panier+"/"+ref+"/"+qtt;
    else{
      res = str.substring(0, lgth-(lgth-str.indexOf("/magasinier")));
      res += "/magasinier/produit_gestion_panier/"+id_panier+"/"+ref+"/"+qtt;

      
    }

    //redirection sur l'url finale
    document.location.href = res;
    //alert("res="+res);
  }
  
  </script>
{% endblock %}

{% block footer %}
{% endblock %}
